#TODO: OpenAPI v2 doesn't allow JSON items serialization. There may be a way to represent it in v3 (https://github.com/OAI/OpenAPI-Specification/issues/437), but Redoc isn't ready for it yet. Using items definition also allows specifying item definition (type and description). If we want to have cleaner documentation it may be worth it to consider if any of supported serializers could be added as new suggested format or if we can push for inclusion of JSON serializer into standard (https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#fixed-fields-7 serialization options are described in "collectionFormat").
#TODO: Confirm that term "Visitor" should be used when referring to user of tracked site.
swagger: '2.0'
info:
  title: Tracking API
  description: |
    **No authentication.**
  version: 'auto'
host: your-instance-name.piwik.pro
basePath: /
schemes:
  - https
produces:
  - image/gif
paths:
  /ppms.php:
    get:
      summary: Tracking endpoint
      description: |
        Endpoint tracking actions (page views, events and visits).
      consumes:
        - text/plain; charset=utf-8
      parameters:
        - name: idsite
          in: query
          #TODO: Make sure we're already using new name in docs.
          description: Application ID (previously Website ID).
          required: true
          type: string
          format: UUID
          minLength: 32
          maxLength: 32
          example: 892d04bd-6e2b-4914-bfb4-bac721b37235
        - name: rec
          in: query
          description: Consent to tracking (value "1" allows it).
          required: true
          type: integer
          #TODO: Confirm that those are only valid options.
          minimum: 0
          maximum: 1
          example: 1
        - name: url
          in: query
          description: URL of action.
          required: true
          type: string
          format: URL
          example: http://example.com/path/to/page.html
        - name: action_name
          in: query
          #TODO: Link to more info about categories
          #TODO: Check if recommended parameters are still most important
          description: |
            **Recommended** Name of action.

            It is possible to categorize actions by preceding them with one or more category names separated by a slash
            character (``/``).
          type: string
          example: help/delivery/shipping
        - name: _id
          in: query
          description: |
            **Recommended** Visitor ID.

            It allows you to use the application identifier of a Visitor instead of a default identifier generated by
            the analytics. See: [Recognizing Visitors](https://help.piwik.pro/analytics/recognizing-visitors/).
          type: string
          format: hexadecimal
          minLength: 16
          maxLength: 16
          example: 257cc22df0ec483a
        - name: rand
          in: query
          description: |
            **Recommended** Cache buster.

            Its value should be unique for every request to make sure that the request is sent to server and not
            read from a cache. Value can be random or sequential (e.g. UNIX timestamp). It is especially useful if
            the visitor is behind some kind of caching proxy.
          type: string
          example: 1521232150
        - name: urlref
          in: query
          #TODO: Check what spelling we're using: referrer vs referrer.
          description: |
            HTTP referrer.

            The URL of the previous page that linked to current one.
          type: string
          format: URL
          example: http://example.com/path/to/previous/page.html
        - name: _cvar
          in: query
          #TODO: Confirm description of item format.
          #TODO: Link to a definition of scopes.
          description: |
            [Custom variables](https://help.piwik.pro/analytics/custom-variables/) set on the ``visit`` scope.

            Format: Object serialized with JSON:

              - key - (`string`) Custom variable ID
              - value - Array with:
                - (`string`) Custom variable name, max length: 200 characters
                - (`string`) Custom variable value, max length: 200 characters
          type: string
          #TODO: See JSON comment.
          format: JSON
          #TODO: Look for better example of custom variable.
          example: {"1":["AspectRatio","16:9"],"2":["Height","1080"],"3":["Width","1920"]}
        - name: cvar
          in: query
          #TODO: Confirm description of item format.
          #TODO: Link to a definition of scopes.
          description: |
            [Custom variables](https://help.piwik.pro/analytics/custom-variables/) set on the ``page`` scope.

            Format: Object serialized with JSON:

              - key - (`string`) Custom variable ID
              - value - Array with:
                - (`string`) Custom variable name, max length: 200 characters
                - (`string`) Custom variable value, max length: 200 characters
          type: string
          #TODO: See JSON comment.
          format: JSON
          #TODO: Look for better example of custom variable.
          example: {"1":["AspectRatio","16:9"],"2":["Height","1080"],"3":["Width","1920"]}
        - name: _idvc
          in: query
          #TODO: Link to definition of a visit.
          description: |
            Visit counter.

            It sets the visit number of the visitor. It should be used when the application already tracks how many times the visitor
            used it and you want to override default visit counter.

            Used in `Visitors` > `Engagement` > `Visits by visit number` report.
          type: integer
          example: 42
        - name: _viewts
          in: query
          description: |
            Time of previous visit.

            Used in `Visitors` > `Engagement` > `Visits by days since last visit` report.
          type: integer
          format: UNIX timestamp
          #TODO: Confirm that it doesn't include milliseconds.
          example: 1521232150
        - name: _idts
          in: query
          description: |
            Time of first visit.

            Used in `Goals` > `Days to Conversion` report.
          type: integer
          format: UNIX timestamp
          example: 1521232150
        - name: res
          in: query
          description: Resolution of the visitor's device in pixels.
          type: string
          format: '{height}x{width}'
          example: 1920x1080
        - name: h
          in: query
          description: Hour when the request was made in the visitor's local time.
          type: integer
          minimum: 0
          maximum: 23
          example: 16
        - name: m
          in: query
          description: Minute when the request was made in the visitor's local time.
          type: integer
          minimum: 0
          maximum: 59
          example: 44
        - name: s
          in: query
          description: Second when the request was made in the visitor's local time.
          type: integer
          minimum: 0
          maximum: 59
          example: 12
        - name: ua
          in: query
          description: |
            `User-Agent` browser value. It can be used to override value send in request HTTP header.

            It is used to detect Visitors browser and operating system.
          type: string
          example: |
            Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.162 Safari/537.36
        - name: lang
          in: query
          description: |
            `Accept-Language` browser value. It can be used to override value send in request HTTP header.

            It's used to guess Visitors country when GeoIP is not able to determine it.
          type: string
          example: en-US,en;q=0.9,pl;q=0.8
        - name: uid
          in: query
          description: |
            User ID.

            Can be used to identify Visitor by the application (e.g. login name, email address or internal
            user ID). See: [Recognizing Visitors](https://help.piwik.pro/analytics/recognizing-visitors/).

            It allows merging visits across different devices (e.g. laptop, tablet and smartphone).
          type: string
          minLength: 1
          example: PhilipFry
        - name: cid
          in: query
          description: |
            Configuration ID.

            Semi-unique hash generated for the visitor's browser (based on configuration and installed plugins).
            This parameter overwrites visitor's `config_id`. For further explanation please read the following article:
            [Recognizing Visitors](https://help.piwik.pro/analytics/recognizing-visitors/) - the `Fingerprint` section.
          type: string
          format: hexadecimal
          minLength: 16
          maxLength: 16
          #TODO: Check if hexadecimal string is case sensitive.
          example: 257cc22df0ec483a
        - name: new_visit
          in: query
          description: Force start of new visit when value is ``1``.
          type: integer
          minimal: 0
          maximal: 1
          example: 1
        - name: dimensionID
          in: query
          description: |
            [Custom dimension](https://help.piwik.pro/analytics/custom-dimensions/) value for specific ID.
            Assigns arbitrary value to specific `visit` or `action` dimension.

            ``ID`` in the parameter name should be replaced with its integer value (e.g. `dimension1`, `dimension2`,
            `dimension999`).
          type: string
          example: blue
        - name: link
          in: query
          description: External URL opened by the Visitor. It is recommended to set ``url`` parameter to same value.
          type: string
          format: URL
          example: http://help-example.com/how-to/register.html
        - name: download
          in: query
          #TODO: Should we recommend setting url parameter to same value?
          description: URL of downloaded file.
          type: string
          format: URL
          example: http://example.com/files/TermsOfService.pdf
        - name: search
          in: query
          description: |
            Internal search query. This is used to track what was searched by a visitor in the application. See:
            [Site search](https://help.piwik.pro/analytics/site-search/).

            Requests using this parameter are excluded from the general page view statistics.
          type: string
          example: sherlock holmes
        - name: search_cat
          in: query
          description: |
            Internal search category. This is used to track if visitor specified a category during a search of the application.
            See: [Site search](https://help.piwik.pro/analytics/site-search/).

            Requests using this parameter are excluded from the general page view statistics.
          type: string
          example: Movies & TV
        - name: search_count
          in: query
          description: |
            Number of results of internal search.

            Used to track number of results found by the visitor.
          type: integer
          example: 2218
        - name: pv_id
          in: query
          description: |
            Unique page view ID generated when the page is loaded.

            This is used to identify further actions performed during that page view (e.g. events) as part of
            single page view.
          type: string
          format: hexadecimal
          minimum: 6
          maximum: 6
          example: ff5c6d
        - name: idgoal
          in: query
          #TODO: Unify Ecommerce naming scheme. Rest of parameters refer to Ecommerce order, not cart.
          description: |
            Goal ID. Signifies that a goal has been reached and tracks its conversion.

            Value ``0`` is reserved for Ecommerce cart tracking.
          type: integer
          example: 15
        - name: revenue
          in: query
          description: |
            Revenue value of achieved goal.

            Currency of the value does not matter, but only one should be used by the application (e.g. USD).
          type: number
          example: 4.99
        - name: ec_id
          in: query
          description: Ecommerce order ID.
          type: string
          example: order-123-customer-321
        - name: ec_items
          in: query
          #TODO: Confirm format in example is valid.
          #TODO: Confirm that all attributes of item are required.
          #TODO: Add limits to the item attributes (e.g. string max length).
          description: |
            Ecommerce order item list.

            Each item on the list must contain:

              - sku: `string` Stock keeping unit.
              - name: `string` Name of item.
              - category: `string` Category of item.
              - price: `number` Price of item.
                Currency of this value does not matter, but only one should be used by the application (e.g. USD).
              - quantity: `integer` Quantity of item.
          type: string
          #TODO: See JSON comment.
          format: JSON
          example:
            - sku: "craft-311"
              name: "Unicorn Iron on Patch"
              category: "Crafts & Sewing"
              price: 4.99
              quantity: 3
            - sku: "craft-312"
              name: "Unicorn Lamp"
              category: "Crafts & Sewing"
              price: 13.25
              quantity: 1
        - name: ec_st
          in: query
          description: |
            Ecommerce order sub-total (order cost without shipping).

            Currency of the value does not matter, but only one should be used by the application (e.g. USD).
          type: number
          example: 4.99
        - name: ec_tx
          in: query
          description: |
            Ecommerce order tax.

            Currency of the value does not matter, but only one should be used by the application (e.g. USD).
          type: number
          example: 4.99
        - name: ec_sh
          in: query
          description: |
            Ecommerce order shipping.

            Currency of the value does not matter, but only one should be used by the application (e.g. USD).
          type: number
          example: 4.99
        - name: ec_dt
          in: query
          description: |
            Ecommerce order discount.

            Currency of the value does not matter, but only one should be used by the application (e.g. USD).
          type: number
          example: 4.99
        - name: _ects
          in: query
          description: |
            Time of last Ecommerce order.

            Used in `Days since last order` report.
          type: integer
          format: Unix timestamp
          example: 1521232150
        - name: gt_ms
          in: query
          #TODO: Previously it was specified as generation time with mention that JavaScript tracker includes in it also loading time. Can we simplify this to always recommend that interpretation?
          description: |
            Page generation and load time in milliseconds.

            Used for example in `Page speed` report.
          type: integer
          example: 264
        - name: cs
          in: query
          description: |
            Page charset.

            Used to decode text data sent in request.
          type: string
          default: UTF-8
          example: ISO-8859-1
        - name: cookie
          in: query
          description: Status of Cookie capability in Visitor browser (value "1" indicates that it is enabled).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: fla
          in: query
          description: Status of Flash plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: java
          in: query
          description: Status of Java plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: dir
          in: query
          #TODO: Confirm name of plugin.
          description: Status of Adobe Director plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: qt
          in: query
          description: Status of QuickTime plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: realp
          in: query
          description: Status of RealPlayer plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: pdf
          in: query
          #TODO: Confirm name of plugin.
          description: Status of PDF plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: wma
          in: query
          #TODO: Confirm name of plugin.
          description: |
            Status of Windows Media Player plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: gears
          in: query
          #TODO: Confirm name of plugin.
          description: Status of (Google) Gears plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: ag
          in: query
          description: Status of Silverlight plugin in Visitor browser (value "1" indicates that it is installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        #TODO: Link to custom event description.
        - name: e_c
          in: query
          description: Custom event category.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: graph
        - name: e_a
          in: query
          description: Custom event action.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: start-date
        - name: e_n
          in: query
          description: Custom event name.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: finantial-report
        - name: e_v
          in: query
          description: Custom event value.
          type: number
          format: float
          minimum: 0
          example: 201704
        #TODO: Link to content tracking description.
        - name: c_n
          in: query
          description: Content name.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: recommended-products
        - name: c_p
          in: query
          description: Content piece.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: Unicorn Iron on Patch
        - name: c_t
          in: query
          description: Content target.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: http://example.com/product/unicorn-iron-on-path.html
        - name: c_i
          in: query
          description: Content interaction.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: show details
        #TODO: Decide if media analytics should be described in separate document and link to it if yes. For now those parameters are not included in this specification.
        - name: send_image
          in: query
          description: |
            Request response content:

            - ``0`` - HTTP 204 [No content]
            - ``1`` - HTTP 200 [1 pixel GIF]
          type: integer
          minimum: 0
          maximum: 1
          default: 1
          example: 0
        - name: bots
          in: query
          description: |
            Bots tracking:

            - ``0`` - disabled
            - ``1`` - enabled
          type: integer
          minimum: 0
          maximum: 1
          default: 0
          example: 0
        - name: token_auth
          in: query
          description: Authentication token used by SuperUser or Admin in requests using parameters that require it.
          type: string
          minLength: 32
          maxLength: 32
          example: caa18074df8347b684d7b943b2484fe9
        - name: cip
          in: query
          description: |
            Override IP.

            This parameter requires authentication using the ``token_auth`` parameter.
          type: string
          format: IPv4|IPv6
          example: 172.16.254.1
        - name: cdt
          in: query
          #TODO: Link to page describing how to force re-processing of a report.
          description: |
            Override request time. You can use it when importing archive HTTP logs.

            If time set this way is from the future, override will be ignored and the current time will be used instead.

            If this parameter is used it is necessary to re-process the report for time range containing overridden time,
            otherwise such requests will not be included in the reports.

            It is possible to override request time without authentication if the difference between set time and current
            one is less than or equal to 24h. Setting time earlier than this requires authentication using the ``token_auth`` parameter.
          type: string
          format: UNIX timestamp|UTC DateTime<YYYY-MM-DD hh:mm:ss>
          example: '2018-02-24 15:34:48'
        - name: country
          in: query
          description: |
            Override country.

            This parameter requires authentication using the ``token_auth`` parameter.
          type: string
          format: ISO 3166-1 alpha-2 code (lowercase)
          example: us
        - name: region
          in: query
          description: |
            Override region.

            Format of [region codes](https://www.maxmind.com/download/geoip/misc/region_codes.csv) is defined in
            [MaxMind's](https://www.maxmind.com/) GeoIP database.

            This parameter requires authentication using the ``token_auth`` parameter.
          type: string
          #TODO: Check if Maxmind uses codes defined in any standard.
          #TODO: Check if those codes are still accurate (migration to GeoIPv2).
          #TODO: Check if codes should be uppercase.
          format: 2 letter region code
          example: AE
        - name: city
          in: query
          description: |
            Override city.

            This parameter requires authentication using the ``token_auth`` parameter.
          type: string
          example: New York
        - name: lat
          in: query
          description: |
            Override latitude.

            This parameter requires authentication using the ``token_auth`` parameter.
          type: number
          #TODO: Check if there's a limit to the number of decimal places.
          format: Decimal degrees
          #TODO: Check if it's possible to set minimum below zero. Redoc doesn't render this correctly.
          minimium: -90
          maximum: 90
          example: 40.7629659
        - name: lon
          in: query
          description: |
            Override longitude.

            This parameter requires authentication using the ``token_auth`` parameter.
          type: number
          format: Decimal degrees
          minimium: -180
          maximum: 180
          example: -74.0023705
        - name: uia
          in: query
          description: |
            Allows to track user anonymously.

            - ``1`` - all IP bytes will be masked (0.0.0.0), no GeoIP data will be stored and visits won't be matched by the fingerprinting process
            - ``0`` - all available visitor data will be enriched if anonymized previously
          type: integer
          minimium: 0
          maximum: 1
          example: 1
      responses:
        200:
          description: OK
        204:
          description: No content
        400:
          description: Bad Request
    post:
      summary: Tracking endpoint
      #TODO: Confirm if mentioning GET parameters in description is enough or do we need to repeat all of them here.
      description: |
        Endpoint tracking actions (page views, events and visits).

        In addition to standard tracking parameters from GET request, it is also able to handle bulk requests.
      consumes:
        #TODO: Confirm that this endpoint expects only application/json (no application/x-www-form-urlencoded) requests.
        - application/json
      parameters:
        - in: body
          required: true
          schema:
            type: object
            required:
              - token_auth
              - requests
            properties:
              token_auth:
                description: |
                  Authentication token used by SuperUser or Admin in requests using parameters that require it.
                type: string
                minLength: 32
                maxLength: 32
                example: caa18074df8347b684d7b943b2484fe9
              requests:
                type: array
                description: |
                  List of requests to track (bulk processing).

                  This parameter require authentication using ``token_auth`` parameter.
                items:
                  type: string
                example:
                  - "?idsite=892d04bd-6e2b-4914-bfb4-bac721b37235&url=http%3A%2F%2Fexample.com%2F&action_name=pageview&rec=1"
                  - "?idsite=892d04bd-6e2b-4914-bfb4-bac721b37235&url=http%3A%2F%2Fexample.com%2Fsub%2Fpage.html&action_name=pageview&rec=1"
      responses:
        200:
          description: OK
        204:
          description: No content
        400:
          description: Bad Request
